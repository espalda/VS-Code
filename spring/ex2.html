0. pagination - 검색 기능 추가

1. Criteria.java 에 매개변수 search와 type 추가 및 getter setter 설정 및 toString 추가

컨트롤러에서 매개변수 추가시 Integer type으로 사용해야 함

컨트롤러에서 매개변수를 Criteria cri로 넘겨줄시 Criteria의 매개변수에 int type 추가

(int 로 진행하는 이유는 생성자에서 자동 초기화로 넘겨주기 때문에)

텍스트 추가
private int page; //현재 페이지
private int perPageNum;	//한 페이지 당 컨텐츠 갯수
private int type;	//검색 카테고리 value값은 숫자로 설정했기 때문에 int
private String search;	//input창에 검색할 값
		
public Criteria() {	//기본 생성자
	this.page = 1;
	this.perPageNum = 10;
	this.type = 0;
	this.search = "";
}

@Override
public String toString() {
	 return "Criteria [page=" + page + ", perPageNum=" + perPageNum + ", type=" + type + ", search=" + search + "]";
}
내용을 입력하세요.
텍스트 추가
2. list.jsp에 검색을 위한 select option input 추가

텍스트 추가
<form class="" method="get" action="<%=request.getContextPath()%>/board/list">
	<select name="type">
		<option value="0">선택</option>
		<option value="1" <c:if test="${pageMaker.criteria.type eq 1}">selected</c:if> >제목</option>
		<option value="2" <c:if test="${pageMaker.criteria.type eq 2}">selected</c:if> >내용</option>
		<option value="3" <c:if test="${pageMaker.criteria.type eq 3}">selected</c:if> >작성자</option>
	</select>
	<input type="text" name="search" value="${pageMaker.criteria.search}">
	<button type="submit">검색</button>
</form>
내용을 입력하세요.
텍스트 추가
<c:if test="${pageMaker.criteria.type eq 1}">selected</c:if> 는 선택한 타입 선택 유지 기능


3. list.jsp의 pagination 구현 코드에 &search=${pageMaker.criteria.search}&type=${pageMaker.criteria.type} 추가

텍스트 추가
<ul class="pagination" style="justify-content: center;">
	<c:if test="${pageMaker.prev}">
	    <li class="page-item">
	    <a class="page-link" href="<%=request.getContextPath()%>/board/list?page=${pageMaker.startPage-1}
                  &type=${pageMaker.criteria.type}&search=${pageMaker.criteria.search}">Previous</a></li>
    </c:if>
	    
    <c:forEach begin="${pageMaker.startPage }" end="${pageMaker.endPage}" var="index">
	    <li class="page-item">	
	    <a class="page-link" href="<%=request.getContextPath()%>/board/list?page=${index}
                  &type=${pageMaker.criteria.type}&search=${pageMaker.criteria.search}">${index}</a></li>
	</c:forEach>

    <c:if test="${pageMaker.next}">
	    <li class="page-item">
	    <a class="page-link" href="<%=request.getContextPath()%>/board/list?page=${pageMaker.endPage+1}
                  &type=${pageMaker.criteria.type}&search=${pageMaker.criteria.search}">Next</a></li>
    </c:if>
</ul>
내용을 입력하세요.
텍스트 추가
4. BoardMapper.xml 에 코드 추가

텍스트 추가
<select id="getBoardList" resultType="kr.green.spring.vo.BoardVO">
  	select * from board where valid = 'I'
  	<if test="type == 1"> and title like concat('%', #{search}, '%') </if>		
  	<if test="type == 2"> and contents like concat('%', #{search}, '%') </if> 	
    <if test="type == 3"> and writer like concat('%', #{search}, '%') </if>
  	order by num desc
  	limit #{pageStart}, #{perPageNum}
</select>

<select id="getTotalCount" resultType="int">
	select count(*) from board where valid = 'I'
	<if test="type == 1"> and title like concat('%', #{search}, '%') </if>
	<if test="type == 2"> and contents like concat('%', #{search}, '%') </if>
	<if test="type == 3"> and writer like concat('%', #{search}, '%') </if>
</select>
내용을 입력하세요.
텍스트 추가
concat : 값을 이어 붙이는 함수

like를 통해 검색 기능을 적용


5. 클릭한 페이지 active 적용

list.jsp에 페이지 번호가 생성되는 페이지네이션의 index와 같다면 active를 활성화

<!-- uri의 페이지 번호가 index와 같다면 active를 추가-->

<!-- index : 반복문의 i같은 역할로 증감연산 -->

텍스트 추가
<c:forEach begin="${pageMaker.startPage }" end="${pageMaker.endPage}" var="index">	
	<c:if test="${pageMaker.criteria.page == index}">	
	    <li class="page-item active">
	    <a class="page-link" href="<%=request.getContextPath()%>/board/list?page=${index}
                   &type=${pageMaker.criteria.type}&search=${pageMaker.criteria.search}">${index}</a></li>
	</c:if>
	<c:if test="${pageMaker.criteria.page != index}">	
	    <li class="page-item">
	    <a class="page-link" href="<%=request.getContextPath()%>/board/list?page=${index}
                   &type=${pageMaker.criteria.type}&search=${pageMaker.criteria.search}">${index}</a></li>
	 </c:if>
</c:forEach>
내용을 입력하세요.
텍스트 추가
6. 상황에 따른 검색 유지 기능

?page=${pageMaker.endPage+1}

&type=${pageMaker.criteria.type}

&search=${pageMaker.criteria.search}&perPAgeNum=${pageMaker.criteria.perPageNum}


board/list에서는 pageMaker를 사용하기 때문에 cri로 사용 불가

controller 에 board/display의 매개변수에 Criteria cri 추가

model.addAttribute("cri", cri) 에 추가하여 display에

&type=${cri.type}&search=${cri.search}&perPAgeNum=${cri.perPageNum} 로 추가가능



